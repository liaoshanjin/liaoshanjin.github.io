<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.85.0" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="特污兔" />
  <meta property="og:url" content="https://liaoshanjin.github.io/laravel/larave-response-exception/" />
  <link rel="canonical" href="https://liaoshanjin.github.io/laravel/larave-response-exception/" /><link rel="alternate" type="application/atom+xml" href="https://liaoshanjin.github.ioindex.xml" title="特污兔的博客">

  <script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/liaoshanjin.github.io"
      },
      "articleSection" : "laravel",
      "name" : "自定义接口 response 和 异常",
      "headline" : "自定义接口 response 和 异常",
      "description" : "封装返回的统一消息 接口主流返回 json 格式，其中包含 http状态码，status请求状态，data请求资源结果等等。需要我们有一个 API 接口全局都能有统一的格式和对应的数据处理。\n在 app\/Api\/Helpers 目录 (不存在目录自己新建) 下新建 ApiResponse.php 填入如下内容\n\u0026lt;?php namespace App\\Api\\Helpers; use Symfony\\Component\\HttpFoundation\\Response as HttpBaseResponse; \/** * Trait ApiResponse * * @package App\\Api\\Helpers *\/ trait ApiResponse { \/** * @var int *\/ protected $httpCode = HttpBaseResponse::HTTP_OK; \/** * 设置 Http 的状态码 * * @param $code * * @return $this *\/ public function setHttpCode($code) { $this-\u0026gt;httpCode = $code; return $this; } \/** * 获取 Http 状态码 * * @return int *\/ public function getHttpCode() { return $this-\u0026gt;httpCode; } \/** * 最基础的一个返回 json * * @param $data * @param array $header * * @return \\Illuminate\\Http\\JsonResponse *\/ public function baseResponse($data, $header = []) { return \\Response::json($data, $this-\u0026gt;getHttpCode(), $header); } \/** * 定义返回的格式 * * @param array $data * @param $messageStatus * @param null $httpCode * * @return \\Illuminate\\Http\\JsonResponse *\/ public function status(array $data, $messageStatus, $httpCode = null) { if ( !",
      "inLanguage" : "en-US",
      "author" : "特污兔",
      "creator" : "特污兔",
      "publisher": "特污兔",
      "accountablePerson" : "特污兔",
      "copyrightHolder" : "特污兔",
      "copyrightYear" : "2019",
      "datePublished": "2019-10-24 17:09:10 \u002b0800 CST",
      "dateModified" : "2019-10-24 17:09:10 \u002b0800 CST",
      "url" : "https:\/\/liaoshanjin.github.io\/laravel\/larave-response-exception\/",
      "keywords" : [  ]
  }
</script>
<title>自定义接口 response 和 异常 - 特污兔的博客</title>
  <meta property="og:title" content="自定义接口 response 和 异常 - 特污兔的博客" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="封装返回的统一消息 接口主流返回 json 格式，其中包含 http状态码，status请求状态，data请求资源结果等等。需要我们有一个 API 接口全局都能有统一的格式和对应的数据处理。
在 app/Api/Helpers 目录 (不存在目录自己新建) 下新建 ApiResponse.php 填入如下内容
&lt;?php namespace App\Api\Helpers; use Symfony\Component\HttpFoundation\Response as HttpBaseResponse; /** * Trait ApiResponse * * @package App\Api\Helpers */ trait ApiResponse { /** * @var int */ protected $httpCode = HttpBaseResponse::HTTP_OK; /** * 设置 Http 的状态码 * * @param $code * * @return $this */ public function setHttpCode($code) { $this-&gt;httpCode = $code; return $this; } /** * 获取 Http 状态码 * * @return int */ public function getHttpCode() { return $this-&gt;httpCode; } /** * 最基础的一个返回 json * * @param $data * @param array $header * * @return \Illuminate\Http\JsonResponse */ public function baseResponse($data, $header = []) { return \Response::json($data, $this-&gt;getHttpCode(), $header); } /** * 定义返回的格式 * * @param array $data * @param $messageStatus * @param null $httpCode * * @return \Illuminate\Http\JsonResponse */ public function status(array $data, $messageStatus, $httpCode = null) { if ( !" />
  <meta name="description" content="封装返回的统一消息 接口主流返回 json 格式，其中包含 http状态码，status请求状态，data请求资源结果等等。需要我们有一个 API 接口全局都能有统一的格式和对应的数据处理。
在 app/Api/Helpers 目录 (不存在目录自己新建) 下新建 ApiResponse.php 填入如下内容
&lt;?php namespace App\Api\Helpers; use Symfony\Component\HttpFoundation\Response as HttpBaseResponse; /** * Trait ApiResponse * * @package App\Api\Helpers */ trait ApiResponse { /** * @var int */ protected $httpCode = HttpBaseResponse::HTTP_OK; /** * 设置 Http 的状态码 * * @param $code * * @return $this */ public function setHttpCode($code) { $this-&gt;httpCode = $code; return $this; } /** * 获取 Http 状态码 * * @return int */ public function getHttpCode() { return $this-&gt;httpCode; } /** * 最基础的一个返回 json * * @param $data * @param array $header * * @return \Illuminate\Http\JsonResponse */ public function baseResponse($data, $header = []) { return \Response::json($data, $this-&gt;getHttpCode(), $header); } /** * 定义返回的格式 * * @param array $data * @param $messageStatus * @param null $httpCode * * @return \Illuminate\Http\JsonResponse */ public function status(array $data, $messageStatus, $httpCode = null) { if ( !" />
  <meta property="og:locale" content="zh_CN" />

  <link rel="stylesheet" href="/css/flexboxgrid-6.3.1.min.css" />
  <link rel="stylesheet" href="/css/github-markdown.css" />
  <link rel="stylesheet" href="/css/highlight/tomorrow.min.css" />
  <link rel="stylesheet" href="/css/index.css">
  <link href="/index.xml" rel="alternate" type="application/rss+xml"
    title="特污兔的博客">
  
  <link href="https://fonts.googleapis.com/css?family=Arvo|Permanent+Marker|Bree+Serif" rel="stylesheet">
  
  

  
</head>

<body>
  <article class="post " id="article">
    <div class="row">
      <div class="col-xs-12">
        <div class="site-header">
          
<header>
  <div class="signatures site-title">
    <a href="/">Stringer的博客</a>
  </div>
</header>
<div class="row end-xs">
  
  
</div>
<div class="header-line"></div>

        </div>
        <header class="post-header">
          <h1 class="post-title">自定义接口 response 和 异常</h1>
          
          <div class="row post-desc">
            <div class="col-xs-6">
              
              <time class="post-date" datetime="2019-10-24 17:09:10 CST">
                24 Oct 2019
              </time>
              
            </div>
            <div class="col-xs-6">
              
              <div class="post-author">
                <a target="_blank" href="https://liaoshanjin.github.io/">@特污兔</a>
              </div>
              
            </div>
          </div>
          
        </header>

        <div class="post-content markdown-body">
          
          <h3 id="封装返回的统一消息">封装返回的统一消息</h3>
<p>接口主流返回 <code>json</code> 格式，其中包含 <code>http状态码</code>，<code>status请求状态</code>，<code>data请求资源结果</code>等等。需要我们有一个 API 接口全局都能有统一的格式和对应的数据处理。</p>
<p>在 <code>app/Api/Helpers</code> 目录 (不存在目录自己新建) 下新建 <code>ApiResponse.php</code> 填入如下内容</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">namespace</span> <span style="color:#a6e22e">App\Api\Helpers</span>;

<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Symfony\Component\HttpFoundation\Response</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">HttpBaseResponse</span>;

<span style="color:#e6db74">/**
</span><span style="color:#e6db74"> * Trait ApiResponse
</span><span style="color:#e6db74"> *
</span><span style="color:#e6db74"> * @package App\Api\Helpers
</span><span style="color:#e6db74"> */</span>
<span style="color:#66d9ef">trait</span>  <span style="color:#a6e22e">ApiResponse</span>
{

    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * @var int
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">protected</span> $httpCode <span style="color:#f92672">=</span> <span style="color:#a6e22e">HttpBaseResponse</span><span style="color:#f92672">::</span><span style="color:#a6e22e">HTTP_OK</span>;


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 设置 Http 的状态码
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param $code
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return $this
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setHttpCode</span>($code)
    {
        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">httpCode</span> <span style="color:#f92672">=</span> $code;

        <span style="color:#66d9ef">return</span> $this;
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 获取 Http 状态码
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return int
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getHttpCode</span>()
    {
        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">httpCode</span>;
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 最基础的一个返回 json
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param       $data
</span><span style="color:#e6db74">     * @param array $header
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">baseResponse</span>($data, $header <span style="color:#f92672">=</span> [])
    {
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">\Response</span><span style="color:#f92672">::</span><span style="color:#a6e22e">json</span>($data, $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getHttpCode</span>(), $header);
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 定义返回的格式
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param array $data
</span><span style="color:#e6db74">     * @param       $messageStatus
</span><span style="color:#e6db74">     * @param null  $httpCode
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">status</span>(<span style="color:#66d9ef">array</span> $data, $messageStatus, $httpCode <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>)
    {
        <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span> <span style="color:#a6e22e">is_null</span>($httpCode)) {
            $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setHttpCode</span>($httpCode);
        }

        $format <span style="color:#f92672">=</span> [
            <span style="color:#e6db74">&#39;status&#39;</span> <span style="color:#f92672">=&gt;</span> $messageStatus,
            <span style="color:#e6db74">&#39;code&#39;</span>   <span style="color:#f92672">=&gt;</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">httpCode</span>,
        ];

        $responseArray <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_merge</span>($format, $data);

        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">baseResponse</span>($responseArray);
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 默认成功的消息返回
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param        $message
</span><span style="color:#e6db74">     * @param string $messageStatus
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">message</span>($message, $messageStatus <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;success&#39;</span>)
    {
        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span>([<span style="color:#e6db74">&#39;message&#39;</span> <span style="color:#f92672">=&gt;</span> $message], $messageStatus);
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 数据返回
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param        $data
</span><span style="color:#e6db74">     * @param string $messageStatus
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">success</span>($data, $messageStatus <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;success&#39;</span>)
    {
        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span>([<span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">=&gt;</span> $data], $messageStatus);
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 默认错误的消息返回
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param        $message
</span><span style="color:#e6db74">     * @param string $messageStatus
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">error</span>($message, $messageStatus <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;error&#39;</span>)
    {
        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span>([<span style="color:#e6db74">&#39;message&#39;</span> <span style="color:#f92672">=&gt;</span> $message], $messageStatus);
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 错误的时候消息返回
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param        $message
</span><span style="color:#e6db74">     * @param int    $httpCode
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">failed</span>($message, $httpCode <span style="color:#f92672">=</span> <span style="color:#a6e22e">HttpBaseResponse</span><span style="color:#f92672">::</span><span style="color:#a6e22e">HTTP_BAD_REQUEST</span>)
    {
        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setHttpCode</span>($httpCode)<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">error</span>($message);
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 服务器错误返回
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param string $message
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">internalError</span>($message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;服务器内部错误&#34;</span>)
    {
        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">failed</span>($message, <span style="color:#a6e22e">HttpBaseResponse</span><span style="color:#f92672">::</span><span style="color:#a6e22e">HTTP_INTERNAL_SERVER_ERROR</span>);
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 创建成功的时候提示
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param string $message
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">created</span>($message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;created&#39;</span>)
    {
        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setHttpCode</span>(<span style="color:#a6e22e">HttpBaseResponse</span><span style="color:#f92672">::</span><span style="color:#a6e22e">HTTP_CREATED</span>)<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>($message);
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 删除时的返回
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param string $message
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deleted</span>($message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;deleted&#39;</span>)
    {
        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setHttpCode</span>(<span style="color:#a6e22e">HttpBaseResponse</span><span style="color:#f92672">::</span><span style="color:#a6e22e">HTTP_NO_CONTENT</span>)<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>($message);
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 没有找到的错误
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param string $message
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">notFound</span>($message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Not Found&#39;</span>)
    {
        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setHttpCode</span>(<span style="color:#a6e22e">HttpBaseResponse</span><span style="color:#f92672">::</span><span style="color:#a6e22e">HTTP_NOT_FOUND</span>)<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">error</span>($message);
    }


}
</code></pre></div><h3 id="异常自定义处理">异常自定义处理</h3>
<p>在 <code>app/Api/Helpers</code> 目录下新建 <code>ExceptionReport.php</code> 文件，填入以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">namespace</span> <span style="color:#a6e22e">App\Api\Helpers</span>;

<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Exception</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Illuminate\Auth\Access\AuthorizationException</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Illuminate\Auth\AuthenticationException</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Illuminate\Database\Eloquent\ModelNotFoundException</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Illuminate\Http\Request</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Illuminate\Support\Arr</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Illuminate\Validation\ValidationException</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Symfony\Component\HttpKernel\Exception\MethodNotAllowedHttpException</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Symfony\Component\HttpKernel\Exception\NotFoundHttpException</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Symfony\Component\HttpKernel\Exception\UnauthorizedHttpException</span>;


<span style="color:#e6db74">/**
</span><span style="color:#e6db74"> * Class ExceptionReport
</span><span style="color:#e6db74"> *
</span><span style="color:#e6db74"> * @package App\Api\Helpers
</span><span style="color:#e6db74"> */</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExceptionReport</span>
{

    <span style="color:#66d9ef">use</span> <span style="color:#a6e22e">ApiResponse</span>;

    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * @var
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> $exception;

    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * @var
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> $request;

    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * @var
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">protected</span> $report;


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * @var array
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> $doReport <span style="color:#f92672">=</span> [
        <span style="color:#a6e22e">UnauthorizedHttpException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>     <span style="color:#f92672">=&gt;</span> [<span style="color:#e6db74">&#39;未登录或者登录已失效&#39;</span>, <span style="color:#ae81ff">401</span>],
        <span style="color:#a6e22e">MethodNotAllowedHttpException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span> <span style="color:#f92672">=&gt;</span> [<span style="color:#e6db74">&#39;访问方式不正确&#39;</span>, <span style="color:#ae81ff">405</span>],
        <span style="color:#a6e22e">NotFoundHttpException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>         <span style="color:#f92672">=&gt;</span> [<span style="color:#e6db74">&#39;访问的路由不存在&#39;</span>, <span style="color:#ae81ff">404</span>],
        <span style="color:#a6e22e">ModelNotFoundException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>        <span style="color:#f92672">=&gt;</span> [<span style="color:#e6db74">&#39;模型没有找到&#39;</span>, <span style="color:#ae81ff">404</span>],
        <span style="color:#a6e22e">AuthorizationException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>        <span style="color:#f92672">=&gt;</span> [<span style="color:#e6db74">&#39;没有此权限&#39;</span>, <span style="color:#ae81ff">403</span>],
        <span style="color:#a6e22e">AuthenticationException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>       <span style="color:#f92672">=&gt;</span> [<span style="color:#e6db74">&#39;未授权的访问&#39;</span>, <span style="color:#ae81ff">401</span>],
        <span style="color:#a6e22e">ValidationException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>           <span style="color:#f92672">=&gt;</span> [],
    ];


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * ExceptionReport constructor.
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param $exception
</span><span style="color:#e6db74">     * @param $request
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __construct(<span style="color:#a6e22e">Exception</span> $exception, <span style="color:#a6e22e">Request</span> $request)
    {
        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">exception</span> <span style="color:#f92672">=</span> $exception;
        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">request</span>   <span style="color:#f92672">=</span> $request;
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 接管错误异常
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param \Exception $exception
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \App\Api\Helpers\ExceptionReport
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">make</span>(<span style="color:#a6e22e">Exception</span> $exception)
    {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">static</span>($exception, <span style="color:#a6e22e">\request</span>());
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 判断异常是否已经自定义
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return bool
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">canReport</span>()
    {
        <span style="color:#66d9ef">foreach</span> (<span style="color:#a6e22e">array_keys</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">doReport</span>) <span style="color:#66d9ef">as</span> $exception) {
            <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">exception</span> <span style="color:#a6e22e">instanceof</span> $exception) {
                $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">report</span> <span style="color:#f92672">=</span> $exception;

                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
            }
        }

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
    }

    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 反馈自定义的异常
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">report</span>()
    {
        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">exception</span> <span style="color:#a6e22e">instanceof</span> <span style="color:#a6e22e">ValidationException</span>) {
            $error <span style="color:#f92672">=</span> <span style="color:#a6e22e">Arr</span><span style="color:#f92672">::</span><span style="color:#a6e22e">first</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">exception</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">errors</span>());

            <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">failed</span>(<span style="color:#a6e22e">Arr</span><span style="color:#f92672">::</span><span style="color:#a6e22e">first</span>($error), $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">exception</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span>);
        }

        $message <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">doReport</span>[$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">report</span>];

        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">failed</span>($message[<span style="color:#ae81ff">0</span>], $message[<span style="color:#ae81ff">1</span>]);
    }


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 线上环境时的报错
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">prodReport</span>()
    {
        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">failed</span>(<span style="color:#e6db74">&#39;服务器内部错误&#39;</span>, <span style="color:#ae81ff">500</span>);
    }


}
</code></pre></div><h4 id="接管异常">接管异常</h4>
<p>修改 <code>app/Exceptions</code> 目录下的 <code>Handler.php</code> 文件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">namespace</span> <span style="color:#a6e22e">App\Exceptions</span>;

<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">App\Api\Helpers\ExceptionReport</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Exception</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Illuminate\Foundation\Exceptions\Handler</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">ExceptionHandler</span>;

<span style="color:#e6db74">/**
</span><span style="color:#e6db74"> * Class Handler
</span><span style="color:#e6db74"> *
</span><span style="color:#e6db74"> * @package App\Exceptions
</span><span style="color:#e6db74"> */</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Handler</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExceptionHandler</span>
{

    <span style="color:#f92672">....</span>
    <span style="color:#f92672">....</span>
    <span style="color:#f92672">....</span>


    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">     * 重构异常
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @param \Illuminate\Http\Request $request
</span><span style="color:#e6db74">     * @param \Exception               $exception
</span><span style="color:#e6db74">     *
</span><span style="color:#e6db74">     * @return \Illuminate\Http\JsonResponse|\Illuminate\Http\Response|\Symfony\Component\HttpFoundation\Response
</span><span style="color:#e6db74">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">render</span>($request, <span style="color:#a6e22e">Exception</span> $exception)
    {
        <span style="color:#66d9ef">if</span> ($request<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">ajax</span>() <span style="color:#f92672">||</span> $request<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">is</span>(<span style="color:#e6db74">&#39;api/*&#39;</span>)) {
            $e <span style="color:#f92672">=</span> <span style="color:#a6e22e">ExceptionReport</span><span style="color:#f92672">::</span><span style="color:#a6e22e">make</span>($exception);
            <span style="color:#66d9ef">if</span> ($e<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">canReport</span>()) {
                <span style="color:#66d9ef">return</span> $e<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">report</span>();
            }

            <span style="color:#75715e"># 判断是否开启了 Debug ,开启则显示详细异常，否则使用自定义的异常
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">env</span>(<span style="color:#e6db74">&#39;APP_DEBUG&#39;</span>)) {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">parent</span><span style="color:#f92672">::</span><span style="color:#a6e22e">render</span>($request, $exception);
            } <span style="color:#66d9ef">else</span> {
                <span style="color:#66d9ef">return</span> $e<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prodReport</span>();
            }

        }

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">parent</span><span style="color:#f92672">::</span><span style="color:#a6e22e">render</span>($request, $exception);
    }

}
</code></pre></div>
        </div>

        <div class="row middle-xs">
          <div class="col-xs-12">
            
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            
          </div>
        </div>

        
        

        
        
        <div style="height: 50px;"></div>
        
        <div class="post-comments">
          <div id="disqus_thread"></div>
<script>
  window.addEventListener("load", () => {
    (function() {
      
      var d = document,
        s = d.createElement("script");
      s.src = "https://特污兔.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  });
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>

        </div>
        
        

        <div class="site-footer">
  
  <div class="site-footer-item">
    <a href="/about/" target="_blank">关于我</a>
  </div>
  
  <div class="site-footer-item">
    <a href="https://github.com/liaoshanjin" target="_blank">Github</a>
  </div>
  
  
</div>

      </div>
    </div>
  </article>

  <script src="/js/highlight.pack.js"></script>


<script>
  hljs.initHighlightingOnLoad();
  
  
  
    
    
  
</script>

  

</body>

</html>