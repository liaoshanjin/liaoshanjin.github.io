<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.59.0" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="苦味糖" />
  <meta property="og:url" content="https://liaoshanjin.github.io/others/centos7-install-blog/" />
  <link rel="canonical" href="https://liaoshanjin.github.io/others/centos7-install-blog/" /><link rel="alternate" type="application/atom+xml" href="https://liaoshanjin.github.ioindex.xml" title="苦味糖的博客">

  <script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/liaoshanjin.github.io"
      },
      "articleSection" : "others",
      "name" : "Centos7 安装博客",
      "headline" : "Centos7 安装博客",
      "description" : "1. 环境 1.1 Linux 我们选 centos7 下载地址 摸我 1.2 服务器 我们使用 LNMP 一键安装 地址 摸我 1.3 博客 我们使用 陈家健 的开源 blog 地址 摸我 2. 准备  以下安装约定在服务器的身份是 root 权限，lnmp 安装包在 root 的家目录执行\n在安装完 LNMP 后，我们使用 composer 直接安装 blog ,却发现报错了，那是因为我们的 php 没有打开 fileinfo 扩展，所以我们 需要先开启 fileinfo 扩展，开启的方法有两种，分别是在安装 LNMP 前和安装 LNMP 后。\n 2.1 安装 LNMP 前开启 fileinfo 扩展 我们看下安装 LNMP 的代码\nwget http:\/\/soft.vpser.net\/lnmp\/lnmp1.5.tar.gz -cO lnmp1.5.tar.gz \x26amp;\x26amp; tar zxf lnmp1.5.tar.gz \x26amp;\x26amp; cd lnmp1.",
      "inLanguage" : "en-US",
      "author" : "苦味糖",
      "creator" : "苦味糖",
      "publisher": "苦味糖",
      "accountablePerson" : "苦味糖",
      "copyrightHolder" : "苦味糖",
      "copyrightYear" : "2019",
      "datePublished": "2019-10-24 17:29:09 \x2b0800 CST",
      "dateModified" : "2019-10-24 17:29:09 \x2b0800 CST",
      "url" : "https:\/\/liaoshanjin.github.io\/others\/centos7-install-blog\/",
      "keywords" : [  ]
  }
</script>
<title>Centos7 安装博客 - 苦味糖的博客</title>
  <meta property="og:title" content="Centos7 安装博客 - 苦味糖的博客" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="1. 环境 1.1 Linux 我们选 centos7 下载地址 摸我 1.2 服务器 我们使用 LNMP 一键安装 地址 摸我 1.3 博客 我们使用 陈家健 的开源 blog 地址 摸我 2. 准备  以下安装约定在服务器的身份是 root 权限，lnmp 安装包在 root 的家目录执行
在安装完 LNMP 后，我们使用 composer 直接安装 blog ,却发现报错了，那是因为我们的 php 没有打开 fileinfo 扩展，所以我们 需要先开启 fileinfo 扩展，开启的方法有两种，分别是在安装 LNMP 前和安装 LNMP 后。
 2.1 安装 LNMP 前开启 fileinfo 扩展 我们看下安装 LNMP 的代码
wget http://soft.vpser.net/lnmp/lnmp1.5.tar.gz -cO lnmp1.5.tar.gz &amp;&amp; tar zxf lnmp1.5.tar.gz &amp;&amp; cd lnmp1." />
  <meta name="description" content="1. 环境 1.1 Linux 我们选 centos7 下载地址 摸我 1.2 服务器 我们使用 LNMP 一键安装 地址 摸我 1.3 博客 我们使用 陈家健 的开源 blog 地址 摸我 2. 准备  以下安装约定在服务器的身份是 root 权限，lnmp 安装包在 root 的家目录执行
在安装完 LNMP 后，我们使用 composer 直接安装 blog ,却发现报错了，那是因为我们的 php 没有打开 fileinfo 扩展，所以我们 需要先开启 fileinfo 扩展，开启的方法有两种，分别是在安装 LNMP 前和安装 LNMP 后。
 2.1 安装 LNMP 前开启 fileinfo 扩展 我们看下安装 LNMP 的代码
wget http://soft.vpser.net/lnmp/lnmp1.5.tar.gz -cO lnmp1.5.tar.gz &amp;&amp; tar zxf lnmp1.5.tar.gz &amp;&amp; cd lnmp1." />
  <meta property="og:locale" content="zh_CN" />

  <link rel="stylesheet" href="/css/flexboxgrid-6.3.1.min.css" />
  <link rel="stylesheet" href="/css/github-markdown.css" />
  <link rel="stylesheet" href="/css/highlight/tomorrow.min.css" />
  <link rel="stylesheet" href="/css/index.css">
  <link href="/index.xml" rel="alternate" type="application/rss+xml"
    title="苦味糖的博客">
  
  <link href="https://fonts.googleapis.com/css?family=Arvo|Permanent+Marker|Bree+Serif" rel="stylesheet">
  
  

  
</head>

<body>
  <article class="post " id="article">
    <div class="row">
      <div class="col-xs-12">
        <div class="site-header">
          
<header>
  <div class="signatures site-title">
    <a href="/">苦味糖的博客</a>
  </div>
</header>
<div class="row end-xs">
  
  
</div>
<div class="header-line"></div>

        </div>
        <header class="post-header">
          <h1 class="post-title">Centos7 安装博客</h1>
          
          <div class="row post-desc">
            <div class="col-xs-6">
              
              <time class="post-date" datetime="2019-10-24 17:29:09 CST">
                24 Oct 2019
              </time>
              
            </div>
            <div class="col-xs-6">
              
              <div class="post-author">
                <a target="_blank" href="https://liaoshanjin.github.io/">@苦味糖</a>
              </div>
              
            </div>
          </div>
          
        </header>

        <div class="post-content markdown-body">
          
          

<h4 id="1-环境">1. 环境</h4>

<h5 id="1-1-linux-我们选-centos7-下载地址-摸我-https-opsx-alibaba-com-mirror">1.1 Linux 我们选 centos7 下载地址 <a href="https://opsx.alibaba.com/mirror">摸我</a></h5>

<h5 id="1-2-服务器-我们使用-lnmp-一键安装-地址-摸我-https-lnmp-org-install-html">1.2 服务器 我们使用 LNMP 一键安装 地址 <a href="https://lnmp.org/install.html">摸我</a></h5>

<h5 id="1-3-博客-我们使用-陈家健-的开源-blog-地址-摸我-https-github-com-jcc-blog">1.3 博客 我们使用 陈家健 的开源 blog 地址 <a href="https://github.com/jcc/blog">摸我</a></h5>

<h4 id="2-准备">2. 准备</h4>

<blockquote>
<p>以下安装约定在服务器的身份是 root 权限，lnmp 安装包在 root 的家目录执行</p>

<p>在安装完 LNMP 后，我们使用 composer 直接安装 blog ,却发现报错了，那是因为我们的 php 没有打开 fileinfo 扩展，所以我们 需要先开启 fileinfo 扩展，开启的方法有两种，分别是在安装 LNMP 前和安装 LNMP 后。</p>
</blockquote>

<h5 id="2-1-安装-lnmp-前开启-fileinfo-扩展">2.1 安装 LNMP 前开启 fileinfo 扩展</h5>

<p>我们看下安装 LNMP 的代码</p>

<pre><code class="language-shell">wget http://soft.vpser.net/lnmp/lnmp1.5.tar.gz -cO lnmp1.5.tar.gz &amp;&amp; tar zxf lnmp1.5.tar.gz &amp;&amp; cd lnmp1.5 &amp;&amp; ./install.sh lnmp
</code></pre>

<p>可以拆分为以下步骤</p>

<p><strong>下载解压并进入 LNMP 目录</strong></p>

<pre><code class="language-shell">wget http://soft.vpser.net/lnmp/lnmp1.5.tar.gz -cO lnmp1.5.tar.gz &amp;&amp; tar zxf lnmp1.5.tar.gz &amp;&amp; cd lnmp1.5
</code></pre>

<p><strong>编辑 LNMP 的配置文件 <code>lnmp.conf</code></strong></p>

<pre><code class="language-shell">vim lnmp.conf
</code></pre>

<p><strong>将原来的配置 <code>Enable_PHP_Fileinfo='n'</code> 修改为 开启</strong></p>

<pre><code>Enable_PHP_Fileinfo='y'
</code></pre>

<p><strong>最后执行安装</strong></p>

<pre><code>./install.sh lnmp
</code></pre>

<h5 id="2-2-在-lnmp-安装完以后开启-fileinfo-扩展">2.2 在 LNMP 安装完以后开启 fileinfo 扩展</h5>

<p>严格意义上讲这不算是开启，可以叫做重装 PHP 了，耗时较长， 步骤如下</p>

<p><strong>找到 LNMP 的 解压目录 ，进入目录，</strong></p>

<pre><code>cd ~/lnmp1.5
</code></pre>

<p><strong>同样修改 LNMP 的配置文件 lnmp.conf ，开启 fileinfo 的扩展</strong></p>

<pre><code>vim lnmp.conf

Enable_PHP_Fileinfo='y'
</code></pre>

<p><strong>最后执行升级 bash</strong></p>

<pre><code>./upgrade.sh php
</code></pre>

<p>等待一段时间后安装完成后，就会开启 fileinfo 扩展</p>

<h4 id="3-安装-最新版的-lts-nodejs">3. 安装 最新版的 lts nodejs</h4>

<blockquote>
<p>在查看安装步骤中发现我们的博客 需要使用到 nodejs, 所以我们先预装 node 和 npm</p>
</blockquote>

<h5 id="3-1-使用epel安装">3. 1 使用EPEL安装</h5>

<pre><code class="language-shell">yum install epel-release -y
</code></pre>

<h5 id="3-2-安装完后-就可以使用-yum-命令安装-nodejs-了">3.2 安装完后，就可以使用 yum 命令安装 nodejs 了，</h5>

<p>安装的一般会是 <code>6.x</code> 的版本，并且会将 <code>npm(3.x)</code> 作为依赖包一起安装</p>

<pre><code class="language-shell">yum install nodejs -y
</code></pre>

<h5 id="3-3-安装完成后-验证是否正确的安装">3.3 安装完成后，验证是否正确的安装</h5>

<p><code>node -v</code> 和 <code>npm -v</code>，如果输出如下版本信息，说明成功安装</p>

<pre><code>v6.16.0

3.10.10
</code></pre>

<h5 id="3-4-安装-n-n是nodejs-管理工具">3.4 安装 n， n是nodejs 管理工具</h5>

<pre><code class="language-shell">npm install -g n
</code></pre>

<h5 id="3-5-卸载-nodejs-v6-16-0-版本">3.5 卸载 nodejs (v6.16.0 版本)</h5>

<pre><code class="language-shell">yum remove nodejs npm -y
</code></pre>

<h5 id="3-6-使用-n-安装-最新-lts-版的-nodejs">3.6 使用 n 安装 最新 lts 版的 nodejs</h5>

<pre><code>n latest
</code></pre>

<p>当然也可以安装指定的版本</p>

<pre><code>n 8.11.3  
</code></pre>

<h5 id="3-7-使用-n-选择-切换-node-的版本">3.7 使用 n 选择（切换） node 的版本</h5>

<pre><code>n
</code></pre>

<h5 id="3-8-切换失效的解决方法">3.8 切换失效的解决方法</h5>

<p>我们在切换完毕后执行 <code>node -v</code> , 发现提示 <code>-bash: /usr/bin/node: 没有那个文件或目录</code></p>

<p>我们首先找出 node 的安装路径</p>

<pre><code class="language-shell">which node
</code></pre>

<p>那么我们的 node 所在目录是 <code>/usr/local/bin/node</code></p>

<p>而 n 默认安装路径是 <code>/usr/local</code>，若你的 <code>node</code> 不是在此路径下，n 切换版本就不能把 <code>bin</code> 、<code>lib</code> 、<code>include</code> 、<code>share</code> 复制该路径中，所以我们必须通过 <code>N_PREFIX</code> 变量来修改 n 的默认 <code>node</code> 安装路径。 编辑环境配置文件：</p>

<pre><code class="language-shell">vim ~/.bash_profile
</code></pre>

<p>将下面两行代码插入到文件末尾：</p>

<pre><code class="language-shell">export N_PREFIX=/usr/local             #node实际安装位置
export PATH=$N_PREFIX/bin:$PATH
</code></pre>

<p>保存退出后，执行 <code>source</code> 使修改生效</p>

<pre><code class="language-shell">source ~/.bash_profile
</code></pre>

<p>至此，我们便安装了最新的稳定版的 node 和 npm .可以使用 <code>node -v</code> 和 <code>npm -v</code> 查看版本</p>

<h4 id="4-删除禁用函数">4. 删除禁用函数</h4>

<p>在安装完 PHP 的 fileinfo 扩展后，我们用命令 <code>composer create-project jcc/blog</code> 安装过程中还是会报错</p>

<p>那是因为我们没有删除 php.ini 里面的某些禁用函数</p>

<p>步骤如下：</p>

<p>使用以下命令找出 php.ini 配置文件，发现在 <code>/usr/local/php/etc/php.ini</code></p>

<pre><code class="language-shell">php -i | grep php.ini
</code></pre>

<p>编辑 php.ini 文件</p>

<pre><code class="language-shell">vim  /usr/local/php/etc/php.ini
</code></pre>

<p>找到 disable_functions 删除以下方法</p>

<pre><code>cat /usr/local/php/etc/php.ini | grep disable_functions

proc_open    exec    proc_get_status        symlink        shell_exec    chown (顺便)
</code></pre>

<p>重启 php-fpm</p>

<pre><code>lnmp php-fpm restart
</code></pre>

<h4 id="5-安装博客">5. 安装博客</h4>

<p>前面的准备那么多，终于到了安装步骤啦</p>

<p>首先配置 composer 的中国镜像 ，我们使用 laravel china 的镜像</p>

<pre><code>wget https://dl.laravel-china.org/composer.phar -O /usr/local/bin/composer

chmod a+x /usr/local/bin/composer

composer config -g repo.packagist composer https://packagist.laravel-china.org
</code></pre>

<p>使用 composer 安装 博客 , 因为我使用 lnmp 添加了一个 <code>fashop.test</code> 的站点，并且目录也是这个。我这边先把 <code>fashop.test</code> 这个目录删除了，然在安装：</p>

<p>在删除过程中 我们发现 站点目录下有个 叫 <code>.user.ini</code> 的隐藏文件，即使你是 root 权限也没办法删除。这是你需要执行以下命令，我这边以 <code>/home/wwwroot/fashop.test/.user.ini</code> 为例：</p>

<pre><code class="language-bash"> chattr -i /home/wwwroot/fashop.test/.user.ini
</code></pre>

<p>便可以删除了</p>

<pre><code class="language-shell">cd /home/wwwroot/

composer create-project jcc/blog fashop.test
</code></pre>

<p>问题来了：</p>

<p><img src="http://148.70.84.101/storage/article/2019/08/06/tKagbAt7Njoes7lbxiVKWOQqJqrBsZ5iy4uMaOjM.png" alt="1555556110905.png" /></p>

<p>在安装结束前报错了，这是在 执行 <code>composer.json</code> 里面的 <code>scripts</code> 的 <code>php artisan package:discover</code> 时报错了.</p>

<p>错误原因：</p>

<p><strong>我们的 .env 和 .env.example 文件中的 <code>APP_NAME</code> 为 默认的 <code>PJ Blog</code> ，此处有空格导致报错。</strong></p>

<p>解决方法：修改 .env 和 .env.example 中 的 <code>PJ Blog</code> 为 <code>PJ_Blog</code> 或者自定义</p>

<p>顺便配置一下 mysql 的连接信息</p>

<p>完了继续执行 <code>php artisan package:discover</code> 。</p>

<p><strong>迁移数据库等等</strong></p>

<pre><code>php artisan blog:install
</code></pre>

<p>我们可以在浏览器打开站点 <code>fashp.test/public</code> 发现 权限报错了，解决如下</p>

<pre><code>cd /home/wwwroot/fashop.test/

chmod -R 755 storage/
</code></pre>

<p><strong>接着我们继续执行 <code>php artisan blog:admin</code> 进行安装</strong>。</p>

<p>记录 passport:install 生成的信息</p>

<pre><code>Client ID: 1
Client secret: IbpAAiIr9gI7TrFfvI9cwCqaJ0tleuY78IeBLOJk
Password grant client created successfully.
Client ID: 2
Client secret: ukAomVONB5lyRopWKGS9GWqBnqL2zQ15S6J8d3vd
</code></pre>

<p><strong>接着我们开始配置前端</strong></p>

<p>进入项目根目录，执行执行 <code>npm install</code></p>

<pre><code>cd /home/wwwroot/fashop.test/

npm install
</code></pre>

<p>如果不想使用 node 也可以使用 yarn , 安装如下</p>

<pre><code class="language-shell"># 使用shell脚本安装yarn
curl -o- -L https://yarnpkg.com/install.sh | bash
</code></pre>

<p>打开一个新的 shell 窗口 ，配置 <code>yarn</code></p>

<pre><code class="language-shell"># 配置使用yarn国内的源
yarn config set registry https://registry.npm.taobao.org
</code></pre>

<p>然后在项目根目录执行 <code>yarn</code> 效果和上面 <code>npm install</code> 一样</p>

<p>最后执行 <code>yarn run dev</code> 或者 <code>npm run dev</code></p>

<p>我们在浏览器打开 <code>http://www.fashop.test/public/</code> 便有了原型</p>

<p><strong>设置 博客 语言</strong></p>

<p>在 .env 文件中设置语言为中文， <code>vim .env</code> 在最下面添加</p>

<pre><code>LOCALE=zh_cn
</code></pre>

<p>重新刷新，便是中文网站。</p>

<p><strong>重设站点</strong></p>

<p>虽然我们的网站已经好了，但是样式变形非常严重，打开 <code>F12</code> 刷新页面，发现我们的 <code>css</code></p>

<p>文件没有加载进来。原因是我们的网站是 根目录是 在 <code>/home/wwwroot/fashop.test/</code> 下</p>

<p>而 我们的网站是 <code>laravel</code> 开发的。入口文件应该是 <code>/home/wwwroot/fashop.test/public/</code></p>

<p>所以我们需要修改 nginx 的配置， 进入 NGINX 的配置目录</p>

<pre><code>cd /usr/local/nginx/conf/vhost/
</code></pre>

<p>可以先备份一份</p>

<pre><code>cp fashop.test.conf fashop.test.conf.copy
</code></pre>

<p><strong>编辑 配置文件 <code>fashop.test.conf</code>， 修改入口目录</strong></p>

<pre><code>root  /home/wwwroot/fashop.test;

root  /home/wwwroot/fashop.test/public;
</code></pre>

<p><strong>编辑 配置文件 <code>fastcgi.conf</code> , 注释 含有 <code>open_basedir</code> 的那一行</strong></p>

<pre><code class="language-bash">vim /usr/local/nginx/conf/fastcgi.conf
# fastcgi_param PHP_ADMIN_VALUE &quot;open_basedir=$document_root/:/tmp/:/proc/&quot;;
</code></pre>

<p>重启 lnmp 服务。 <code>lnmp restart</code></p>

        </div>

        <div class="row middle-xs">
          <div class="col-xs-12">
            
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            
          </div>
        </div>

        
        

        
        
        <div style="height: 50px;"></div>
        
        <div class="post-comments">
          <div id="disqus_thread"></div>
<script>
  window.addEventListener("load", () => {
    (function() {
      
      var d = document,
        s = d.createElement("script");
      s.src = "https://苦味糖.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  });
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>

        </div>
        
        

        <div class="site-footer">
  
  <div class="site-footer-item">
    <a href="/about/" target="_blank">关于我</a>
  </div>
  
  <div class="site-footer-item">
    <a href="https://github.com/liaoshanjin" target="_blank">Github</a>
  </div>
  
  
</div>

      </div>
    </div>
  </article>

  <script src="/js/highlight.pack.js"></script>


<script>
  hljs.initHighlightingOnLoad();
  
  
  
    
    
  
</script>

  

</body>

</html>