<!DOCTYPE html>
<html lang="zh_CN">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Stringer">
    <meta name="description" content="stringer 的个人博客">
    <meta name="keywords" content="php,go,程序员">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PHP 运行模式与运行原理"/>
<meta name="twitter:description" content="PHP 运行模式与运行原理 常见的4中PHP运行模式  CGI (通用网关接口) 模式 FAST_CGI 模式 CLI 命令行模式 模块模式  运行模式 CGI (通用网关接口) 模式 每有一个用户请求，都会先要创建 CGI 的子进程，然后处理请求，处理完成后结束这个子进程。
CGI 是一种为了保证 web server 传递过来的数据是标准格式的通用网关协议。
比较老，比较原始，大多已经不用了
FAST_CGI 模式 FAST-CGI 是 CGI 的升级版本。FAST-CGI 像是一个常驻（long-live）型的 CGI，它可以一直执行着。只要激活后，不会每次都要花费时间去 fork 一次，也是一种协议。
FAST-CGI 的工作原理是：
 web server 启动时，载入 FAST-CGI 进程管理器。【PHP 的 FastCGI 进程管理器是 PHP-FPM】 FastCGI 进程管理器自身初始化，启动多个 CGI 解释器进程并等待来自 web server的连接。【在任务管理器中可见多个 php-cgi.exe】 当客户端请求到达 web server 时，FastCGI 进程管理器选择并连接到一个CGI 解释器。web server 将 CGI 环境变量和标准输入发送到 FastCGI 子进程 php-cgi。 FastCGI 子进程完成处理后，将标准输出和错误信息从同一连接返回 web server。当 FastCGI 子进程关闭连接时，请求便处理完成。FastCGI 子进程接着等待并处理来自 FastCGI 进程管理器【运行在web server 中】的下一个连接。在正常的 CGI 模式中，php-cgi."/>

    <meta property="og:title" content="PHP 运行模式与运行原理" />
<meta property="og:description" content="PHP 运行模式与运行原理 常见的4中PHP运行模式  CGI (通用网关接口) 模式 FAST_CGI 模式 CLI 命令行模式 模块模式  运行模式 CGI (通用网关接口) 模式 每有一个用户请求，都会先要创建 CGI 的子进程，然后处理请求，处理完成后结束这个子进程。
CGI 是一种为了保证 web server 传递过来的数据是标准格式的通用网关协议。
比较老，比较原始，大多已经不用了
FAST_CGI 模式 FAST-CGI 是 CGI 的升级版本。FAST-CGI 像是一个常驻（long-live）型的 CGI，它可以一直执行着。只要激活后，不会每次都要花费时间去 fork 一次，也是一种协议。
FAST-CGI 的工作原理是：
 web server 启动时，载入 FAST-CGI 进程管理器。【PHP 的 FastCGI 进程管理器是 PHP-FPM】 FastCGI 进程管理器自身初始化，启动多个 CGI 解释器进程并等待来自 web server的连接。【在任务管理器中可见多个 php-cgi.exe】 当客户端请求到达 web server 时，FastCGI 进程管理器选择并连接到一个CGI 解释器。web server 将 CGI 环境变量和标准输入发送到 FastCGI 子进程 php-cgi。 FastCGI 子进程完成处理后，将标准输出和错误信息从同一连接返回 web server。当 FastCGI 子进程关闭连接时，请求便处理完成。FastCGI 子进程接着等待并处理来自 FastCGI 进程管理器【运行在web server 中】的下一个连接。在正常的 CGI 模式中，php-cgi." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://liaoshanjin.github.io/php/php-principle/" />
<meta property="article:published_time" content="2020-05-18T15:15:09+08:00" />
<meta property="article:modified_time" content="2020-05-18T15:15:09+08:00" />


    
      <base href="https://liaoshanjin.github.io/php/php-principle/">
    
    <title>
  PHP 运行模式与运行原理 · Stringer 的博客
</title>

    
      <link rel="canonical" href="https://liaoshanjin.github.io/php/php-principle/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://liaoshanjin.github.io/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://liaoshanjin.github.io/css/custom.css" />
    

    
    
    <link rel="icon" type="image/png" href="https://liaoshanjin.github.io/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://liaoshanjin.github.io/img/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.59.0" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://liaoshanjin.github.io/">
      Stringer 的博客
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://liaoshanjin.github.io/laravel/">Laravel</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://liaoshanjin.github.io/go/">GO</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://liaoshanjin.github.io/mysql/">MySQL</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://liaoshanjin.github.io/php/">PHP</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://liaoshanjin.github.io/others/">其他</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://liaoshanjin.github.io/about/">关于</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>PHP 运行模式与运行原理</h1>
    </header>

    

<h2 id="php-运行模式与运行原理">PHP 运行模式与运行原理</h2>

<h3 id="常见的4中php运行模式">常见的4中PHP运行模式</h3>

<ol>
<li>CGI (通用网关接口) 模式</li>
<li>FAST_CGI 模式</li>
<li>CLI 命令行模式</li>
<li>模块模式</li>
</ol>

<h3 id="运行模式">运行模式</h3>

<h4 id="cgi-通用网关接口-模式">CGI (通用网关接口) 模式</h4>

<p>每有一个用户请求，都会先要创建 CGI 的子进程，然后处理请求，处理完成后结束这个子进程。</p>

<p>CGI 是一种为了保证 web server 传递过来的数据是标准格式的通用网关协议。</p>

<p>比较老，比较原始，大多已经不用了</p>

<h4 id="fast-cgi-模式">FAST_CGI 模式</h4>

<p>FAST-CGI 是 CGI 的升级版本。FAST-CGI 像是一个常驻（long-live）型的 CGI，它可以一直执行着。只要激活后，不会每次都要花费时间去 fork 一次，也是一种协议。</p>

<p>FAST-CGI 的工作原理是：</p>

<ol>
<li>web server 启动时，载入 FAST-CGI 进程管理器。【PHP 的 FastCGI 进程管理器是 PHP-FPM】</li>
<li>FastCGI 进程管理器自身初始化，启动多个 CGI 解释器进程并等待来自 web server的连接。【在任务管理器中可见多个 php-cgi.exe】</li>
<li>当客户端请求到达 web server 时，FastCGI 进程管理器选择并连接到一个CGI 解释器。web server 将 CGI 环境变量和标准输入发送到 FastCGI 子进程 php-cgi。</li>
<li>FastCGI 子进程完成处理后，将标准输出和错误信息从同一连接返回 web server。当 FastCGI 子进程关闭连接时，请求便处理完成。FastCGI 子进程接着等待并处理来自 FastCGI 进程管理器【运行在web server 中】的下一个连接。在正常的 CGI 模式中，php-cgi.exe 在此便退出了。</li>
</ol>

<p>在 CGI 模式中，可以想象 CGI 通常有多慢，每一个 web 请求 PHP 都必须重新解析 <em>php.ini</em> 、重新载入全部 <em>dll</em> 扩展并重初始化全部数据结构。使用 FastCGI ，所有这些都只在进程启动时发生一次。一个额外的好处是，持续数据库连接可以工作。</p>

<h4 id="cli-命令行模式">CLI 命令行模式</h4>

<p>一般使用调用脚本、查看 PHP 信息时会使用到该模式</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">php -r &#34;phpinfo();&#34; | less # 分页显示</code></pre></div>
<h4 id="模块模式">模块模式</h4>

<ol>
<li>Apache + mod_php</li>
<li>lighttp + spawn-fcgi</li>
<li>nginx  +  PHP-FPM</li>
</ol>

<h3 id="运行原理">运行原理</h3>

<p>PHP-CGI : fast-cgi 是一种协议， 而 php-cgi 是实现了这种协议的进程。不过这种实现比较烂。它是单进程的，一个进程处理一个请求，处理结束后进程就销毁。</p>

<p>PHP-FPM ： 是对 php-cgi 的改进版，它直接管理多个php-cgi 进程/线程。也就是说，php-fpm 是 php-cgi 的进程管理器。因此 php-fpm 也算是 fastcgi 协议的实现。</p>

<p>PHP 的运行原理，就是在服务器启动时，自动载入 php-fpm 进程管理器，从而管理多个 php-cgi 进程来准备响应用户的请求。如下图：</p>

<p><img src="https://liaoshanjin.github.io/images/content/php-work.png" alt="php-work" /></p>

<p><img src="https://liaoshanjin.github.io/images/content/php-cgi-work.png" alt="php-cgi-work" /></p>

<p>由于 php-cgi 是随服务器启动载入的，所以初始化变量只会发生一次。</p>

<h3 id="运行模式和运行原理的区别">运行模式和运行原理的区别</h3>

<p>多个运行模式相当于超市的不同入口，运行原理就是进入超市后的固定的行走路线，通过不同的运行模式（超市入口）进入到底层（进入超市）</p>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>Enter a text here.</p>
    
     © 2020
    
       · 
       <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
